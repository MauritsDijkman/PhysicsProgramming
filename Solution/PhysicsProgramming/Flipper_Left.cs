using System;
using GXPEngine;

public class Flipper_Left : GameObject
{
    MyGame _myGame = null;

    Vec2 start = new Vec2(0, 0);
    Vec2 end = new Vec2(0, 0);

    public LineSegment line = null;

    Ball lineEnd1 = null;
    Ball lineEnd2 = null;


    public Flipper_Left()
    {
        _myGame = (MyGame)game;

        ResetLineRotation();
        Spawn();
    }

    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    //                                                                      Spawn()                                                                              //
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    void Spawn()
    {
        line = new LineSegment(end, start, 0xff00ff00, 4);
        _myGame.AddChild(line);
        _myGame._lines.Add(line);

        lineEnd1 = new Ball(0, 0, 0, 0, start, moving: false);
        lineEnd2 = new Ball(0, 0, 0, 0, end, moving: false);

        _myGame._ball.Add(lineEnd1);
        _myGame._ball.Add(lineEnd2);
    }

    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    //                                                                      MoveLine()                                                                           //
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    void MoveLine()
    {
        if (Input.GetKeyDown(Key.UP))
        {
            DestroyFlipper();

            end.RotateAroundDegrees(-50, start);

            Spawn();
        }

        if (Input.GetKeyUp(Key.UP))
        {
            DestroyFlipper();
            ResetLineRotation();
            Spawn();
        }
    }

    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    //                                                                      DestroyFlipper()                                                                     //
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    void DestroyFlipper()
    {
        _myGame._ball.Remove(lineEnd1);
        lineEnd1.Destroy();

        _myGame._ball.Remove(lineEnd2);
        lineEnd2.Destroy();

        _myGame._lines.Remove(line);
        line.Destroy();
    }

    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    //                                                                      ResetLineRotation()                                                                  //
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    void ResetLineRotation()
    {
        start = new Vec2(game.width - 620, game.height - 150);
        end = new Vec2(game.width - 530, game.height - 120);
    }

    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    //                                                                      Update()                                                                             //
    //-----------------------------------------------------------------------------------------------------------------------------------------------------------//
    void Update()
    {
        MoveLine();
    }
}
